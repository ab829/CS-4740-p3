"""
Returns a list of questions and ids in the form of [(q1,i1),(q2,i2)]

"""
import os
import re

def get_questions():
    questions = []
    with open('question.txt', 'r') as f:
        text = f.read().splitlines()  #returns iterator
        data = iter(text)            
        for line in data:         
            if line[:5] == "<num>":
                q_id = line[-3:]
                next(data)
                next(data)
                q = next(data) 
                questions.append((q,q_id.strip())) #removes blank from _98 vs 100
        
    return questions

"""
Returns a dictionary containing top 5 answers to a given question plus the question's 
id in the form of {[a1],[a2],[a3],[a4],[a5]:id}

Splits each file into chunks of 10 word tokens each. Ranks all chunks
by number of word matches found in question, returns top 5 chucks.

param = dictionary of {question:id} generated by get_questions()
"""
def get_answers(questions):      
    answers = {}   
    for q in questions:
        chunks = []
        q_list = q[0].split() 
        q_id = q[1]
        path = os.path.join(r'C:/Users/ab829/Desktop/p3/doc_dev/', q_id)
        os.chdir(path)
        for filename in os.listdir(os.getcwd()):
            with open(filename, 'r') as f:
                data = f.read()
                data = re.sub("<.*?>", "", data) # regex to get rid of <HTML></TAGS>
                data = data.split()
                s = 0
                e = 10
                while e <= len(data): # deal with last bit of chunk
                    chunk = data[s:e]
                    total = 0
                    for word in q_list: # no stopwords removed
                        if word in chunk:
                            total += 1
                    if total > 0:
                        j = " "                        
                        chunk = j.join(chunk)
                        chunks.append((chunk,total))
                    s += 10
                    e += 10
        chunks = sorted(chunks, key=lambda x: x[1])
        top_answers = []        
        top_scores = chunks[:5]
        for a in top_scores:
            top_answers.append(a[0])
        answers[top_answers] = q_id
        
    return answers
            
        
               
        
